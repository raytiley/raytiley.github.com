<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>raytiley.github.io</title>

    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <h1>  </h1>
      Posted On: February 26, 2015
      <hr />
      <iframe
  width="178" height="24" style="border:0px"
  src="https://mixonic.github.io/ember-community-versions/2015/02/26/the-evolution-of-injecting-services-in-ember">
</iframe>
<p>I've been using Ember for about two years now. One of the things that initially impressed me is you don't need a lot of boilerplate code. At a bare minimum you need an <code>Ember.Application.create()</code> and an application template to get your app running. It won't do anything, but it is a perfectly functioning application. The first Ember app I wrote is still up on the Internet here: <a href="http://raytiley-msse-static-scheduler.herokuapp.com/#/taskSets">http://raytiley-msse-static-scheduler.herokuapp.com</a>.</p>
<p>If you dig into the <a href="https://github.com/raytiley/RealTimeScheduler/tree/master/app/assets/javascripts/app">source code</a> you'll see there are only <code>Routes</code>, <code>Models</code>, and <code>Controllers</code>. Alas, things were simpler back then. The app I develop today has <code>Mixins</code>, <code>Transforms</code>, <code>Helpers</code>, <code>Views</code>, <code>Adapters</code>, <code>Serializers</code>, and I think we just passed fifty <code>Components</code>.</p>
<p>If you are new to Ember then this might seem like a lot to manage, but actually it is quite the opposite. All these things have meaning. They all have their own folder in my app, and just by naming them correctly Ember CLI magically wires them all together into a working application. My favorite thing about Ember is how it can take away the pointless choices, and nothing is more pointless then deciding where to put a thing, or what to call it.</p>
<p>However, it is not all rainbows and unicorns. There have always been these pesky things in real apps that don't fit neatly into one of Ember's buckets. They usually need to be used from multiple parts of your app, think logging, analytics, sessions, authentication, etc. Up until <a href="http://emberjs.com/blog/2015/02/07/ember-1-10-0-released.html">Ember 1.10</a> you had two basic approaches for these shared objects.</p>
<h2>Option One - Make it a Controller</h2>
<p>This is a fine approach. Controller is one of those generic words like manager. When programming if you're not in a creative mood just call it a Manager. Unless you happen to be writing an Ember app, then just call it a Controller. You can then get access to your plethora of controllers using <code>needs</code> or <code>controllerFor</code>. This might look like the following:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// controllers/flash-messages.js</span><br><span class="token comment">// This controller will be a singleton, meaning any place we use it we'll get the same object.</span><br><span class="token comment">// So we can push a message on from a route or a controller and the application template could</span><br><span class="token comment">// display all the messages.</span><br><span class="token keyword">export</span> <span class="token keyword">default</span> Ember<span class="token punctuation">.</span>Controller<span class="token punctuation">.</span><span class="token function">extned</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br><br>  <span class="token function">pushMessage</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Do your sweet thing here</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><br>  <span class="token function-variable function">messages</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Return the latest message, or all the messages, whatever</span><br>  <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string">'someInternalThing'</span><span class="token punctuation">)</span><br><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// routes/posts/view.js</span><br><span class="token comment">// In a Route we can use controllerFor to access our flash message controller.</span><br><span class="token keyword">export</span> <span class="token keyword">default</span> Ember<span class="token punctuation">.</span>Route<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token function-variable function">postComment</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">trollingMessage</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// Do your comment stuff</span><br>      <span class="token keyword">var</span> flashManager <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">controllerFor</span><span class="token punctuation">(</span><span class="token string">'flash-messages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      flashManager<span class="token punctuation">.</span><span class="token function">pushMessage</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token string">'You are a troll.'</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// controllers/posts/view.js</span><br><span class="token comment">// In a controller we can use the needs api to Ember know we need access to the flash-message controller</span><br><span class="token comment">// It is very common to use an alias so you don't have to type controllers a million times</span><br><span class="token keyword">export</span> <span class="token keyword">default</span> Ember<span class="token punctuation">.</span>Controller<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">needs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'flash-message'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">flashManager</span><span class="token operator">:</span> Ember<span class="token punctuation">.</span>computed<span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">'controllers.flash-message'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><br>  <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token function-variable function">upVote</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// Do some voting</span><br>      <span class="token keyword">var</span> flashManager <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'flashManager'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      flashManager<span class="token punctuation">.</span><span class="token function">pushMessage</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'Your vote does not count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>So beyond the obvious fact that controllers are <a href="https://github.com/emberjs/rfcs/pull/15">going away in Ember 2.0</a> this approach has some drawbacks. First, you have two different APIs for getting the same thing depending on if you're trying to get it from a controller or a route. Second, you're limited to where you can access these objects. I may only need to use my flash manager in controllers and routes, but something like a logging service would be useful in other locations such as components.</p>
<h2>Option Two - Dependency Injection with Initializers</h2>
<p>Dependency injection sounds scary, but it's not. It is just a mechanism to reduce coupling between different objects in your application. The example above using <code>needs</code> and <code>controllerFor</code> is one way Ember does dependency injection. If you have ever passed an object to another object's constructor you've done <a href="http://en.wikipedia.org/wiki/Dependency_injection#Constructor_injection">constructor injection</a>.</p>
<p>Tight coupling makes code harder to maintain. Imagine you are an aspiring <code>photographer</code>, but every time you want to take a photo you buy a new <code>iPhone</code> to take a picture. This is analogous to creating a <code>new LoggingService()</code> every time you want to log something in your application.</p>
<p>Besides being quickly broke, you the <code>photographer</code> are tightly coupled to <code>iPhone</code>. If we wanted to change the type of camera you use to 'DigitalSLR' we would need to follow you around and make sure we find every place you might take a picture and switch <code>iPhone</code> to <code>DigitalSLR</code>. This is analogous to having to change every place we use <code>new LoggingService()</code> in a big application.</p>
<p>Now imagine that at the start of every day some magical person put a camera on your bed side table and you used that camera all day. Having the camera provided to you makes it easy to change <code>iPhone</code> to <code>DigitalSLR</code>. We have <strong>injected</strong> the camera <strong>dependency</strong>, and now our code is easier to maintain.</p>
<p>In Ember that magical person that can change your <code>camera</code> in an <code>initializer</code>. Initializers are just bits of code that run before your application is booted and let you set things up. In our initializer we will <code>register</code> our dependency and then <code>inject</code> it into the types of objects where we want to use it. Coding our logging service this way would look like this:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// utils/logger.js</span><br><span class="token comment">// Just a simple object that does some logging for us</span><br><span class="token keyword">export</span> <span class="token keyword">default</span> Ember<span class="token punctuation">.</span>Object<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br><br>  <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Do your sweet thing here</span><br>  <span class="token punctuation">}</span><br><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// initializers/logging.js</span><br><span class="token comment">// In our initializer we import our Logger and then register it as logger:main</span><br><span class="token comment">// Then we can inject logger:main into whatever types of objects we want access to it</span><br><span class="token keyword">import</span> Logger <span class="token keyword">from</span> <span class="token string">'../utils/logger.js'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'logger'</span><span class="token punctuation">,</span><br>  <span class="token function-variable function">initialize</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">container<span class="token punctuation">,</span> application</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// register our logger</span><br>    application<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'logger:main'</span><span class="token punctuation">,</span> Logger<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// inject our logger so it is availble in controllers, routes, and components</span><br>    application<span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'controller'</span><span class="token punctuation">,</span> <span class="token string">'logger'</span><span class="token punctuation">,</span> <span class="token string">'logger:main'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    application<span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'route'</span><span class="token punctuation">,</span> <span class="token string">'logger'</span><span class="token punctuation">,</span> <span class="token string">'logger:main'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    application<span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'component'</span><span class="token punctuation">,</span> <span class="token string">'logger'</span><span class="token punctuation">,</span> <span class="token string">'logger:main'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// controllers/posts/view.js</span><br><span class="token comment">// In our route there is a property logger that is our logging service</span><br><span class="token keyword">export</span> <span class="token keyword">default</span> Ember<span class="token punctuation">.</span>Controller<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br><br>  <span class="token function-variable function">activate</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This route was activated.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>There are lots of different knobs that can be dialed in here. For instance the default behavior is we get a singleton logger, meaning that all the logger properties will be the same across routes, controllers, and components. We could change this. For more details read the <a href="http://emberjs.com/api/classes/Ember.Application.html#method_register">api docs</a>. So what's wrong with this approach? Nothing in particular, I actually quite like it. There are a few things to be aware of however.</p>
<p>Notice I didn't need to declare a <code>logger</code> property on my <code>PostsViewRoute</code>.  The <code>logger</code> property is injected onto all my routes whether I like it or not. I find it good practice to declare my injected properties with <code>null</code> (<code>logger: null</code>). I spent a long time once debugging an injected property conflicting with another property. By declaring it explicitly I prevent myself from accidentally using that name for something else.</p>
<p>Another thing about this approach is it can be a bit tedious to limit your injections. Something like logging we want everywhere, but that's not always the case. You can <a href="http://emberjs.com/api/classes/Ember.Application.html#method_inject">configure inject</a> a bunch, but if you're lazy it is easy just to give all the routes something that maybe only one or two of them need.</p>
<h2>Meet Ember.inject.service and Ember.inject.controller</h2>
<p>What's great about Ember is how it embraces paving cow paths. Pretty much every non trivial Ember application is doing some combination of the above. In my own app I have lots of <code>needs</code> (pun intended) and several initializers injecting services. These patterns are tried, trued, and we know where all the cow shit is. So lets smooth them over using some new APIs. The controller part of our first example becomes:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// controllers/posts/view.js</span><br><span class="token keyword">export</span> <span class="token keyword">default</span> Ember<span class="token punctuation">.</span>Controller<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">flashManager</span><span class="token operator">:</span> Ember<span class="token punctuation">.</span>inject<span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token string">'flash-message'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><br>  <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token function-variable function">upVote</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// Do some voting</span><br>      <span class="token keyword">var</span> flashManager <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'flashManager'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      flashManager<span class="token punctuation">.</span><span class="token function">pushMessage</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'Your vote does not count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Granted this doesn't do a whole lot for us, we only got to remove one line of code. Also if we need access to a controller from a route we still need to use <code>controllerFor</code>. What I'm really excited about is <code>Ember.inject.service()</code>. Our second example becomes:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// services/logger.js</span><br><span class="token comment">// Just a simple object that does some logging for us</span><br><span class="token keyword">export</span> <span class="token keyword">default</span> Ember<span class="token punctuation">.</span>Service<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br><br>  <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Do your sweet thing here</span><br>  <span class="token punctuation">}</span><br><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// routes/posts/view.js</span><br><span class="token keyword">export</span> <span class="token keyword">default</span> Ember<span class="token punctuation">.</span>Controller<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">logger</span><span class="token operator">:</span> Ember<span class="token punctuation">.</span>inject<span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">'logger'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><br>  <span class="token function-variable function">activate</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'logger'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This route was activated.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Sweet! We got to remove a whole file, the initializer is gone. Notice also that we moved <code>logger.js</code> from <code>utils</code> to <code>services</code>. By placing our services in the <code>services</code> folder Ember CLI will find them for us automatically. One less pointless choice. (the choice of <code>utils</code> was pointless. I just made that up in my own app.) I also like this better because I'm explicitly delcaring that I want the <code>logger</code> service available on <code>PostsViewRoute</code>. Other routes won't have a <code>logger</code> automatically. This also means that I don't have to worry about my injected property conflicting.</p>
<p>Now there are some rules for what can be injected where, but there is no public API for customizing that yet. For the most part you can inject services where you would think, including <code>routes</code>, <code>controllers</code>, <code>views</code>, and <code>components</code>. This isn't only for your own services. Addons can expose services and you can inject them into your apps objects. For example Ember Data has an <a href="https://github.com/emberjs/data/pull/2820">open PR</a> to allow you to expose the <code>store</code> as a service.</p>
<p>I'm a big fan of this API. It allowed me to delete a bunch of initializers in our app, and removed some silly choices from my day to day development. I think the Services API shows how Ember can constantly iterate on ideas without making me throw away all my code.</p>


        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'raytiley'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          
    </div>
    <script src="javascripts/scale.fix.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-2186528-10', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>